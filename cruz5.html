<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cruz del Sur 5</title>

  <!-- Icono y fuente -->
  <link rel="icon" type="image/png" sizes="64x64" href="logos/happyhost.png" sizes="128x128">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">



  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <!-- Tu CSS completo, con overrides incluidos al final -->
  <link rel="stylesheet" href="unidades.css">
</head>

<body>

  <header class="header">
    <div class="barra-menu">
      <div class="logo">
        <img src="logos/happy host.png" alt="Logo Happy Host" href="index.html">
      </div>

      <h1 class="titulo-header">Cruz del Sur 5</h1>

      <div class="volver">
  <a href="#" id="btnVolver" class="boton-volver">‚Üê Volver a alojamientos</a>
</div>
    </div>
  </header>

  <div class="fondo-blur">
  <section class="detalle-alojamiento">
    <div class="imagen-principal">
      <img src="unidades/cds5/cds5_2.jpg" alt="Foto principal Cruz 5">
      <div class="miniaturas-container">
        <button class="flecha izq">&#10094;</button>
        <div class="miniaturas" id="miniaturas-scroll">
          <img src="unidades/cds5/cds5_2.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_3.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_5.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_6.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_7.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_8.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_9.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_10.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_11.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_12.jpg" alt="cruz5">
          <img src="unidades/cds5/cds5_1.jpg" alt="cruz5">
        </div>
        <button class="flecha der">&#10095;</button>
      </div>
      
      <div class="info servicios">
        <h3>Servicios</h3>
        <div class="iconos-servicios">
          <div><img src="iconos/2 personas.png" alt="WiFi"><span>2 pax</span></div>
          <div><img src="iconos/wifi.png" alt="WiFi"><span>WiFi</span></div>
          <div><img src="iconos/cocina.png" alt="Cocina"><span>Cocina</span></div>
          <div><img src="iconos/estacionamiento.png" alt="Estacionamiento"><span>Estacionamiento</span></div>
          <div><img src="iconos/sabanas y toallas.png" alt="S√°banas"><span>Blancos</span></div>
          <div><img src="iconos/calefaccion.png" alt="Calefacci√≥n"><span>Calefacci√≥n</span></div>
          <div><img src="iconos/parrilla.png" alt="Parrilla"><span>Parrilla</span></div>
        </div>
      </div>
      
    </div>
<div class="motor-reservas-fijo">
     <div class="reserva">
      <!-- Fechas en la misma l√≠nea -->
      <div class="dates">
        <div class="date-field" id="df-start">
          <input
            type="text"
            id="start"
            placeholder="Check in"
            readonly
          >
        </div>
        <div class="date-field" id="df-end">
          <input
            type="text"
            id="end"
            placeholder="Check out"
            readonly
          >
        </div>
      </div>
    
      <!-- Hu√©spedes -->
      <!-- Oculto para que el script siga funcionando -->
      <input type="hidden" id="guests" value="1" />

       <!-- Control visual para hu√©spedes -->
        <div class="huespedes-control">
           <button id="menos">‚àí</button>
           <span id="contador">1 hu√©sped</span>
           <button id="mas">+</button>
        </div>
    
      <!-- Selecci√≥n de moneda -->
      <label for="currency" style="display:none;">Moneda</label>
      <select id="currency" style="display:none;">
      <option value="USD">USD</option>
      <option value="ARS">ARS</option>
      </select>
    
      <!-- Bot√≥n -->
      <button id="btnReservar" disabled>Reservar ahora</button>
    
      <!-- Resumen debajo -->
      <div id="resultado"></div>
  
    </div>
  </div>
  </section>

   <section class="contenido-info">
    <div class="info descripcion">
      <h3>Descripci√≥n</h3>
      <p><strong>Cruz del Sur</strong> es una acogedora casa estilo loft, ideal para quienes buscan una estancia tranquila y en contacto con la naturaleza. Ubicada en el barrio de Las Balsas, a solo 2 km del centro de Villa La Angostura, esta propiedad combina comodidad y encanto en un entorno rodeado de vegetaci√≥n.</p>

        <p>En la planta baja, encontrar√°s un amplio espacio que integra una cocina completamente equipada, comedor y un living con grandes ventanales que permiten la entrada de luz natural y ofrecen vistas al verde exterior. La zona del living cuenta con un c√≥modo sof√° y una Smart TV, perfecta para disfrutar de una noche de pel√≠culas (no cuenta con TV por cable). Adem√°s, en este nivel, se encuentra un ba√±o completo.</p>
        <p>La planta alta encontraras una espaciosa habitaci√≥n estilo loft con cama king, donde podr√°s descansar pl√°cidamente mientras disfrutas de la tranquilidad del entorno.</p>
        <p>La casa tambi√©n dispone de Wi-Fi, un espacio para estacionamiento techado y un amplio parque ideal para relajarse al aire libre.</p>
        <p><strong>Distancias de inter√©s:</strong> 800 metros de Bah√≠a Las Balsas -
            5 minutos en auto al acceso del Cerro Bayo (7.6 km hasta la base)</p>
        <p><strong>Cruz del Sur </strong> es el refugio perfecto para quienes desean escapar del bullicio y disfrutar de la paz y belleza natural de Villa La Angostura.</p>
        
        <strong>Check in / Check out AUT√ìNOMO</strong></p>
    </div>

    <div class="info mapa">
      <h3>Ubicaci√≥n</h3>
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3021.34864777023!2d-71.6252554!3d-40.7763487!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9610bf888f6bab3f%3A0xb7395e0be7f27229!2sHAPPY%20HOST%20PATAGONIA%20-%20Casas%20Cruz%20del%20Sur!5e0!3m2!1ses!2sar!4v1745588245558!5m2!1ses!2sar"  allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      <div class="redes-contacto">
        <a href="https://wa.me/5492944700773" target="_blank">
          <img src="logos/whatsapp.png" alt="WhatsApp">
        </a>
        <a href="https://www.instagram.com/hhpatagonia?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank">
          <img src="logos/instagram.png" alt="Instagram">
        </a>
        <a href="https://x.com/hhpatagonia?s=21&t=UH7im4Y6WJT3722TpA05Iw">
          <img src="logos/twitter.png" alt="Correo">
        </a>
      </div>   
    </div>
  </section>
  </div>

  <script>

    const scrollContainer = document.getElementById('miniaturas-scroll');
    const flechaIzq = document.querySelector('.flecha.izq');
    const flechaDer = document.querySelector('.flecha.der');
  
    flechaIzq.addEventListener('click', () => {
      scrollContainer.scrollBy({ left: -150, behavior: 'smooth' });
    });
  
    flechaDer.addEventListener('click', () => {
      scrollContainer.scrollBy({ left: 150, behavior: 'smooth' });
    });


   document.addEventListener("DOMContentLoaded", function () {
   const principal = document.querySelector('.imagen-principal > img');
   const miniaturas = document.querySelectorAll('#miniaturas-scroll img');

    miniaturas.forEach(mini => {
    mini.addEventListener('click', () => {
      principal.src = mini.src; // Cambia la imagen principal
       });
     });
    });
  document.addEventListener("DOMContentLoaded", function () {
  const principal = document.querySelector('.imagen-principal > img');
  const miniaturas = document.querySelectorAll('#miniaturas-scroll img');

  miniaturas.forEach(mini => {
    mini.addEventListener('click', () => {
      principal.src = mini.src;

      // Quitar la clase activa a todas las miniaturas
      miniaturas.forEach(m => m.classList.remove('activa'));

      // Agregar clase activa a la que se clicke√≥
      mini.classList.add('activa');
      });
     });
    });
  </script>

<script>
const HOUSE_ID = 601714;
const ROOM_ID = 668505;

const params = new URLSearchParams(window.location.search);
const checkin = params.get("checkin");
const checkout = params.get("checkout");
const huespedes = params.get("huespedes");

localStorage.removeItem("checkin");
localStorage.removeItem("checkout");
localStorage.removeItem("huespedes");

const startInput = document.getElementById('start');
const endInput = document.getElementById('end');
const guestsInput = document.getElementById('guests');
const currSelect = document.getElementById('currency');
const resDiv = document.getElementById('resultado');
const reservarBtn = document.getElementById('btnReservar');
const menosBtn = document.getElementById('menos');
const masBtn = document.getElementById('mas');
const contador = document.getElementById('contador');

let cantidad = parseInt(huespedes) || 1;
const hoy = new Date();
hoy.setHours(0, 0, 0, 0);

window.addEventListener("DOMContentLoaded", () => {
  if (checkin) startInput.value = checkin;
  if (checkout) endInput.value = checkout;
  if (huespedes) {
    guestsInput.value = huespedes;
    cantidad = parseInt(huespedes);
  }
  actualizarContador();
  calculate();
});

const startPicker = flatpickr(startInput, {
  altInput: true,
  altFormat: 'd/m/Y',
  dateFormat: 'Y-m-d',
  defaultDate: checkin || null,
  minDate: hoy,
  disableMobile: true,
  onChange: (selectedDates) => {
    if (selectedDates[0]) {
      calculate();
    }
  }
});

const endPicker = flatpickr(endInput, {
  altInput: true,
  altFormat: 'd/m/Y',
  dateFormat: 'Y-m-d',
  defaultDate: checkout || null,
  minDate: hoy,
  disableMobile: true,
  onChange: calculate
});

startPicker.config.onChange.push((selectedDates) => {
  if (selectedDates[0]) {
    endPicker.setDate(null);
    endPicker.jumpToDate(selectedDates[0]);
    endPicker.open();
  }
});

let fechasOcupadas = [];

async function loadDisabledDates(picker) {
  try {
    const resp = await fetch('https://disponibilidad-happy-host-patagonia.onrender.com/api/ocupados/cruzdelsur5');
    if (!resp.ok) throw new Error(await resp.text());
    const rangos = await resp.json();
    fechasOcupadas = rangos;

    picker.set('disable', [
      ...rangos.map(r => ({ from: r.from, to: r.to })),
      date => date < hoy
    ]);
  } catch (e) {
    console.error('No se pudieron cargar fechas ocupadas:', e.message);
  }
}

[startPicker, endPicker].forEach(picker => {
  picker.config.onReady.push(() => loadDisabledDates(picker));
  picker.config.onMonthChange.push(() => loadDisabledDates(picker));
  picker.config.onOpen.push(() => loadDisabledDates(picker));
});

function actualizarContador() {
  contador.textContent = cantidad === 1 ? '1 hu√©sped' : `${cantidad} hu√©spedes`;
  guestsInput.value = cantidad;
}

menosBtn.addEventListener('click', () => {
  if (cantidad > 1) {
    cantidad--;
    actualizarContador();
    calculate();
  }
});

masBtn.addEventListener('click', () => {
  if (cantidad < 6) {
    cantidad++;
    actualizarContador();
    calculate();
  }
});

guestsInput.addEventListener('input', calculate);

// üîí Fijamos moneda a USD y ocultamos el selector
currSelect.value = 'USD';
currSelect.style.display = 'none';
currSelect.disabled = true;

function hayCruceConFechasOcupadas(checkin, checkout) {
  const ci = new Date(checkin);
  const co = new Date(checkout);
  ci.setHours(0, 0, 0, 0);
  co.setHours(0, 0, 0, 0);

  return fechasOcupadas.some(({ from, to }) => {
    const inicio = new Date(from);
    const fin = new Date(to);
    inicio.setHours(0, 0, 0, 0);
    fin.setHours(0, 0, 0, 0);
    return (
      (ci > inicio && ci < fin) ||
      (co > inicio && co < fin) ||
      (ci <= inicio && co >= fin)
    );
  });
}

async function calculate() {
  const startValue = startInput.value;
  const endValue = endInput.value;
  const guests = +guestsInput.value;
  const moneda = 'USD';

  if (!startValue || !endValue) {
    resDiv.textContent = 'Seleccion√° ambas fechas.';
    reservarBtn.disabled = true;
    return;
  }

  const sd = new Date(startValue), ed = new Date(endValue);
  if (ed <= sd) {
    resDiv.textContent = 'La fecha de fin debe ser posterior a la de inicio.';
    reservarBtn.disabled = true;
    return;
  }

  const MAX_GUESTS = 2, FREE_GUESTS = 2;
  if (guests > MAX_GUESTS) {
    resDiv.textContent = `La capacidad m√°xima es de ${MAX_GUESTS} hu√©spedes.`;
    reservarBtn.disabled = true;
    return;
  }

  if (hayCruceConFechasOcupadas(sd, ed)) {
    resDiv.textContent = 'El rango incluye fechas ya ocupadas.';
    reservarBtn.disabled = true;
    return;
  }

  const noches = Math.round((ed - sd) / (1000 * 60 * 60 * 24));
  resDiv.textContent = 'Cargando‚Ä¶';
  reservarBtn.disabled = true;

  try {
    const url = `https://disponibilidad-happy-host-patagonia.onrender.com/api/precios-diarios?start=${startValue}&end=${endValue}&houseId=${HOUSE_ID}&roomId=${ROOM_ID}`;
    const resp = await fetch(url);
    if (!resp.ok) throw new Error(await resp.text());
    const { dias = [], extras = [] } = await resp.json();

    if (dias.length === 0) {
      resDiv.textContent = 'No hay precios para estas fechas.';
      return;
    }

    const minStay = dias
      .map(d => Math.min(...d.prices.map(p => p.min_stay)))
      .reduce((a, b) => Math.min(a, b), Infinity);

    if (noches < minStay) {
      resDiv.textContent = `La estad√≠a m√≠nima es de ${minStay} noches.`;
      return;
    }

    let baseUSD = 0;
    for (let i = 0; i < noches; i++) {
      const d = dias[i];
      const p = d.prices.find(x => noches >= x.min_stay && noches <= x.max_stay)
        || d.prices.reduce((a, b) => a.min_stay < b.min_stay ? a : b);
      baseUSD += p.price_per_day;
    }

    const extraUnit = extras[0]?.price_per_day || 12;
    const extraQty = Math.max(0, guests - FREE_GUESTS);
    const extraUSD = extraQty * extraUnit * noches;
    const totalUSD = baseUSD + extraUSD;

    let html = `<ul class="booking-summary">
      <li>Noches: ${noches}</li>
      <li>Hu√©spedes: ${guests}</li>` +
      (extraQty > 0 ? `<li>Extra hu√©sped: ${extraUSD.toLocaleString()} USD</li>` : '') +
      `<li><strong>Total:</strong> ${totalUSD.toLocaleString()} USD</strong></li>
    </ul>`;
    resDiv.innerHTML = html;

    reservarBtn.disabled = false;
    reservarBtn.onclick = () => {
      const qs = new URLSearchParams({
        propertyId: HOUSE_ID,
        roomTypeId: ROOM_ID,
        checkInDate: startValue,
        checkOutDate: endValue,
        numberOfGuests: guests,
        totalPrice: totalUSD,
        currency: 'USD'
      }).toString();
      window.location.href = `formulario.html?${qs}`;
    };
  } catch (e) {
    console.error(e);
    resDiv.textContent = 'Error al obtener datos: ' + e.message;
  }
}
</script>



<script src="volver.js"></script>

</body>
</html>